{% extends "base.html" %}

{% block title %}
    Inventory
{% endblock %}

{% block content %}
    <h2>Current Inventory</h2>

    {% if inventory %}
        <style>
            table {
                border-collapse: collapse;
                width: 100%;
                margin-top: 20px;
            }

            th {
                background-color: #f2f2f2;
            }
        </style>

        <table id="actionsTable" class="display table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Unit</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody>
                {% for row in inventory %}
                <tr>
                    <td>{{ row.latest_date }}</td>
                    <td>{{ row.item_name }}</td>
                    <td>{{ row.unit_name }}</td>
                    <td>{{ row.net_quantity }}</td>
                    <td>${{ "{:,.2f}".format(row.total_price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <script>
        $(document).ready(function () {
            // Clone header row for filters
            $('#actionsTable thead tr').clone(true).appendTo('#actionsTable thead');

            // Create empty dropdowns in the second row
            $('#actionsTable thead tr:eq(1) th').each(function (i) {
                $(this).html('<select style="width:100%"><option value="">All</option></select>');

                var select = $('select', this);

                // When a filter is selected, search the column
                select.on('change', function () {
                    var val = $.fn.dataTable.util.escapeRegex($(this).val());
                    table.column(i).search(val ? '^' + val + '$' : '', true, false).draw();
                });
            });

            // Initialize DataTable
            var table = $('#actionsTable').DataTable({
                orderCellsTop: true,
                fixedHeader: true,
                initComplete: function () {
                    this.api().columns().every(function () {
                        var column = this;
                        var select = $('select', $('#actionsTable thead tr:eq(1) th').eq(column.index()));

                        // Fill dropdown with unique values
                        column.data().unique().sort().each(function (d) {
                            var text = d.replace(/<[^>]*>?/gm, '');
                            if (text && select.find("option[value='" + text + "']").length === 0) {
                                select.append('<option value="' + text + '">' + text + '</option>');
                            }
                        });
                    });
                }
            });
        });
        </script>


        <hr style="border: none; border-top: 1px solid #999; margin: 30px 0;"
        <br />
        <p style="font-size: 1.5em; text-align: right; font-weight: bold;">Total inventory: {{ formatted_total_inventory }}</p>
    {% else %}
        <p>No inventory data yet.</p>
    {% endif %}
{% endblock %}