{% extends "base.html" %}

{% block title %}Manage Items & Units{% endblock %}

{% block content %}
<h2>Manage Items, Categories & Units</h2>
<br />
<div class="manage-buttons">
    <a href="#items" class="manage-btn">Items</a>
    <a href="#categories" class="manage-btn">Categories</a>
    <a href="#units" class="manage-btn">Units</a>
</div>
<br />

<div class="inventory-container">

    <!-- Items Section -->
    <div class="section">
        <div id="items" class="form-card">
            <h4>Add Item</h4>
            <form method="post">
                <input type="hidden" name="action" value="add_item">
                <div class="form-group">
                    <label for="item_name">Item name:</label>
                    <input class="form-control" type="text" name="item_name" required>
                </div>
                <button class="btn btn-primary mt-2" type="submit" name="action" value="add_item">Add Item</button>
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    {% if 'Item' in message %}
                    <div class="alert alert-{{ category }} mt-2">{{ message }}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    {% endif %}
                {% endfor %}
                {% endwith %}
            </form>
        </div>
                <div class="list-card">
            <h4>Existing Items</h4>
            <ul>
                {% for item in items %}
                    <li>
                        {{ item.name }}

                        <!-- Edit button -->
                        <a href="{{ url_for('main.edit_item', id=item.id) }}" 
                        class="small-grey-btn">
                        Edit
                        </a>
                        
                        <!-- Delete button -->
                        <form action="{{ url_for('main.delete_item', id=item.id) }}" 
                            method="POST" 
                            class="inline-form">
                            <button type="submit" 
                                    class="small-grey-btn"
                                    onclick="return confirm('Are you sure you want to delete this item?');">
                                Delete
                            </button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>

    </div>

    <!-- Categories Section -->
    <div class="section">
        <div id="categories" class="form-card">
            <h4>Add Category</h4>
            <form method="post">
                <input type="hidden" name="action" value="add_category">
                <div class="form-group">
                    <label for="category_name">Category name:</label>
                    <input class="form-control" type="text" name="category_name" required>
                </div>
                <button class="btn btn-primary mt-2" type="submit" name="action" value="add_category">Add Category</button>
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    {% if 'Category' in message %}
                    <div class="alert alert-{{ category }} mt-2">{{ message }}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    {% endif %}
                {% endfor %}
                {% endwith %}
            </form>
        </div>
        <div class="list-card">
            <h4>Existing Categories</h4>
            <ul>
                {% for category in categories %}
                    <li>
                        {{ category.name }}

                        <!-- Edit button -->
                        <a href="{{ url_for('main.edit_category', id=category.id) }}" 
                        class="small-grey-btn">
                        Edit
                        </a>
                        
                        <!-- Delete button -->
                        <form action="{{ url_for('main.delete_category', id=category.id) }}" 
                            method="POST" 
                            class="inline-form">
                            <button type="submit" 
                                    class="small-grey-btn"
                                    onclick="return confirm('Are you sure you want to delete this category?');">
                                Delete
                            </button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>

    </div>

    <!-- Units Section -->
    <div class="section">
        <div id="units" class="form-card">
            <h4>Add Unit</h4>
            <form method="post">
                <input type="hidden" name="action" value="add_unit">
                <div class="form-group">
                    <label for="unit_name">Unit name:</label>
                    <input class="form-control" type="text" name="unit_name" required>
                </div>
                <button class="btn btn-primary mt-2" type="submit" name="action" value="add_unit">Add Unit</button>
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    {% if 'Unit' in message %}
                    <div class="alert alert-{{ category }} mt-2">{{ message }}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    {% endif %}
                {% endfor %}
                {% endwith %}
                </form>
        </div>
        <div class="list-card">
            <h4>Existing Units</h4>
            <ul>
                {% for unit in units %}
                    <li>
                        {{ unit.name }}

                        <!-- Edit button -->
                        <a href="{{ url_for('main.edit_unit', id=unit.id) }}" 
                        class="small-grey-btn">
                        Edit
                        </a>
                        
                        <!-- Delete button -->
                        <form action="{{ url_for('main.delete_unit', id=unit.id) }}" 
                            method="POST" 
                            class="inline-form">
                            <button type="submit" 
                                    class="small-grey-btn"
                                    onclick="return confirm('Are you sure you want to delete this unit?');">
                                Delete
                            </button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<!-- Scroll to Top Button -->
<button type="button" id="scrollTopBtn" class="btn btn-primary rounded-circle"
        style="width: 50px; height: 50px; position: fixed; bottom: 20px; right: 20px; 
               display: none; z-index: 1000;">
    <i class="bi bi-arrow-up"></i>
</button>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("scrollTopBtn");

    window.addEventListener("scroll", function () {
        if (document.documentElement.scrollTop > 200) {
            btn.style.display = "flex";
            btn.style.alignItems = "center";
            btn.style.justifyContent = "center";
        } else {
            btn.style.display = "none";
        }
    });

    btn.addEventListener("click", function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
});
</script>
{% endblock %}